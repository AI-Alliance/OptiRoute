<div class="row gx-0" style="height: 100vh;">
  <div class="d-flex align-items-start flex-column col-2 m-3">
  
    <h2>Marker type</h2>
    <div class="btn-group">
      <button type="button" [disabled]="hasDepotMarker()" class="btn btn-outline-primary" [class.active]="selectedType == PlaceType.DEPOT" (click)="selectedType = PlaceType.DEPOT">Depot</button>
      <button type="button" class="btn btn-outline-primary" [class.active]="selectedType == PlaceType.CLIENT" (click)="selectedType = PlaceType.CLIENT">Client</button>
    </div>

  
    <div class="mt-5 h2 position-relative ">Places:
      <span *ngIf="!placeMarkers.length" class="position-absolute top-0 start-100 translate-middle p-2  bg-danger border border-light rounded-circle">
      </span>
    </div>
    <ul class="list-group w-100">
      <li class="list-group-item" *ngFor="let pm of placeMarkers">
        <div class="form-group row" >
          <label >{{pm.type.toUpperCase()}}</label>
          <div class="col text-muted">
            {{pm.description}} 
          </div>
          <div class="col-4" *ngIf="pm.type == PlaceType.CLIENT">
            Demand: {{pm.demand}}
          </div>
          
        </div>
      </li>
    </ul>

    
    <div class="mt-5 h2">Vehicles:
      <button class="btn btn-secondary position-relative" (click)="addVehicle()">
        <span *ngIf="!vehicles.length" class="position-absolute top-0 start-100 translate-middle p-2  bg-danger border border-light rounded-circle">
        </span>
        <span class="h5">Add vehicle</span>
      </button>
      
    </div>
    
    
    <ul class="list-group">
      <li class="list-group-item" *ngFor="let vehicle of vehicles">
        <div class="form-group row" >
          <small class="text-muted">{{vehicle.uuid}}</small>
          
          <label class="col-3 col-form-label">Capacity:</label>
          <div class="col">
            <input class="form-control" min="0" max="20" type="number" (change)="vehicle.capacity = +$any($event.target).value" [value]="vehicle.capacity">
          </div>
          <div class="col-2">
            <button class="btn btn-sm btn-outline-danger" (click)="removeVehicle(vehicle.uuid)">
              X
            </button>
          </div>
        </div>
      </li>
    </ul>
    
    <div class="mt-auto w-100">
      <select class="form-select" (change)="selectedAlgorithm = $any($event.target).value">
        <option [value]="''" >Select algorithm</option>
        <option [value]="algorithm" *ngFor="let algorithm of algorithms">{{algorithm}}</option>
      </select>
    </div>
    
    
    <div class="w-100 d-flex justify-content-between mt-5">
      
      <button class="btn btn-success btn-lg" [disabled]="!taskDataIsReady()" (click)="sendTask()">
        <ng-container *ngIf="!taskLoading">
          Send Task
        </ng-container>
        <ng-container *ngIf="taskLoading">
          <span class="spinner-border spinner-border-sm"></span>
          Loading...
        </ng-container>
        
      </button> 
      <button class="btn btn-primary" [disabled]="!taskDataIsReady()" (click)="downloadInput()">
        Download input
      </button>
      
    </div>
    <div class="mt-3">
      <label class="form-label">Input File</label>
      <input class="form-control" type="file" (change)="onFileSelect($event)" accept=".json">
    </div>

    <!-- <button class="btn btn-success" type="button" disabled>
      <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      Loading...
    </button> -->
  </div>
  <div class="col" *ngIf="gMapsService.apiLoaded| async">
    <google-map  height="100%" width="100%" [options]="options" (mapClick)="onMarkerAdd($event)">
      
      <map-marker *ngFor="let placeMarker of placeMarkers"  [position]="placeMarker.latLng" [options]="placeMarker.markerOptions" #marker="mapMarker" (mapMouseover)="openInfoWindow(placeMarker, marker)" ></map-marker>
      <map-info-window>
        <div class="my-3">
          <div class="mb-1">
            {{lastMarker?.placeId}}
          </div>
          <div class="form-group row" *ngIf="lastMarker && lastMarker.type!= PlaceType.DEPOT">
            <label class="col-4 col-form-label">Demand:</label>
            <div class="col">
              <input class="form-control" min="0" max="20" type="number" (change)="lastMarker.demand = +$any($event.target).value" [value]="lastMarker.demand">
            </div>
          </div>
        </div>
        <button *ngIf="lastMarker" (click)="deleteMarker(lastMarker)" class="btn btn-sm btn-danger">Delete marker</button>
        <button *ngIf="lastMarker" (click)="getGeoInfo(lastMarker)" class="btn btn-sm btn-info">Info</button>
      </map-info-window>
      <ng-container *ngFor="let dr of directionsResults; index as i ">
        <map-directions-renderer *ngIf="dr" [directions]="dr" [options]="directionsRendererOptions[i]"></map-directions-renderer>
      </ng-container>
    </google-map>
    
  </div>
</div>
